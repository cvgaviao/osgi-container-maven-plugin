#FELIX

FROM openjdk:8-jre-alpine
MAINTAINER Cristiano Gavi√£o <cvgaviao@c8tech.com.br>

ARG IMAGE_VERSION
ARG IMAGE_RELEASE_DATE
ARG ZIP_FILE
ARG PROJECT_ID
ARG LOCAL_REPOSITORY_ID
ARG CONFIGURATOR_INIT_FILE_NAME
ENV PROJECT_PATH=/opt/share/${PROJECT_ID}
ENV REPOSITORY_PATH=${PROJECT_PATH}/repository
ENV CONFIG_PATH=${PROJECT_PATH}/conf
ENV LOG_PATH=${PROJECT_PATH}/logs
ENV REPOSITORIES=file:${REPOSITORY_PATH}/${LOCAL_REPOSITORY_ID}
ENV LOGBACK_FILE=${CONFIG_PATH}/logback.xml
ENV CONFIGURATOR_INIT_FILE=${CONFIG_PATH}/${CONFIGURATOR_INIT_FILE_NAME}
ENV PORT=8080

WORKDIR ${PROJECT_PATH}
#RUN echo "ZIP_FILE -> ${ZIP_FILE}"
#RUN echo "PROJECT_ID -> ${PROJECT_ID}"
#RUN echo "IMAGE_VERSION -> ${IMAGE_VERSION}"
#RUN echo "IMAGE_RELEASE_DATE -> ${IMAGE_RELEASE_DATE}"
#RUN echo "CONFIGURATOR_INIT_FILE_NAME -> ${CONFIGURATOR_INIT_FILE_NAME}"
#RUN echo "LOGBACK_FILE -> ${LOGBACK_FILE}"
#RUN echo "CONFIGURATOR_INIT_FILE -> ${CONFIGURATOR_INIT_FILE}"
#RUN echo "REPOSITORIES -> ${REPOSITORIES}"

#VOLUME ["${LOG_PATH}","${CONFIG_PATH}", "${REPOSITORY_PATH}"]
VOLUME ["${LOG_PATH}"]

ADD ${ZIP_FILE} ${PROJECT_PATH}

LABEL releaseDate=$IMAGE_RELEASE_DATE
LABEL version=$IMAGE_VERSION

EXPOSE ${PORT} 

# Create a script to pass command line args to java
RUN echo "java -Dconfigurator.initial=${CONFIGURATOR_FILE} -Dobr.repository.url=${REPOSITORIES} -Dlogback.configurationFile=${LOGBACK_FILE} -jar ./bin/felix.jar \$@" > run_container.sh
RUN apk add --update bash && rm -rf /var/cache/apk/*

ENTRYPOINT ["/bin/bash", "run_container.sh"]
CMD [""]